API BACKEND CHO MINO TRADING APP (Sử dụng Laravel Sanctum)

=== AUTHENTICATION APIs ===

1. API ĐĂNG KÝ
POST /api/auth/register
Request Body:
- email: string (required, email format, unique)
- phone: string (required, 7-15 characters, numbers + +().-\s)
- full_name: string (required, minimum 2 characters)
- date_of_birth: string (required, ISO date format)
- user_type: string (required, default "individual")
- address: string (optional)
- password: string (required, minimum 6 characters)
- password_confirmation: string (required, must match password)

Response Success:
- success: true
- message: "Registration successful"
- data:
  - user_id: uuid
  - email: string
  - phone: string
  - full_name: string
  - status: "pending_verification"

Response Error:
- success: false
- message: "Validation failed"
- errors: object với các field bị lỗi

2. API ĐĂNG NHẬP
POST /api/auth/login
Request Body:
- identifier: string (required, email or phone)
- password: string (required, minimum 6 characters)
- type: string (optional, "email" or "phone", auto-detect)

Response Success:
- success: true
- message: "OTP sent successfully"
- data:
  - identifier: string
  - type: "email" or "phone"
  - masked_identifier: string (example: "***@gmail.com" or "***-***-1234")
  - expires_in: 300 (5 minutes)

Response Error:
- success: false
- message: "Invalid credentials"
- errors: object với identifier/password errors

3. API GỬI OTP
POST /api/auth/send-otp
Request Body:
- identifier: string (required)
- type: string (required, "email" or "phone")

Response Success:
- success: true
- message: "OTP sent successfully"
- data:
  - identifier: string
  - masked_identifier: string
  - expires_in: 300

4. API XÁC THỰC OTP
POST /api/auth/verify-otp
Request Body:
- identifier: string (required)
- otp_code: string (required, 6 digits)
- type: string (required, "email" or "phone")

Response Success:
- success: true
- message: "OTP verified successfully"
- data:
  - user:
    - id: uuid
    - email: string
    - phone: string
    - full_name: string
    - status: "verified" or "pending_ekyc"
    - created_at: datetime
  - token: sanctum_token
  - token_type: "Bearer"
  - expires_at: datetime (nếu có set expiration)

Response Error:
- success: false
- message: "Invalid OTP"
- errors: object với otp_code errors

5. API GỬI LẠI OTP
POST /api/auth/resend-otp
Request Body:
- identifier: string (required)
- type: string (required, "email" or "phone")

Response Success:
- success: true
- message: "OTP resent successfully"
- data:
  - identifier: string
  - masked_identifier: string
  - expires_in: 300

6. API LẤY THÔNG TIN USER
GET /api/user
Headers:
- Authorization: Bearer {sanctum_token}
- Accept: application/json

Response Success:
- success: true
- data:
  - id: uuid
  - email: string
  - phone: string
  - full_name: string
  - date_of_birth: date
  - user_type: string
  - address: string
  - status: string
  - email_verified_at: datetime
  - phone_verified_at: datetime
  - created_at: datetime
  - updated_at: datetime

7. API ĐĂNG XUẤT
POST /api/auth/logout
Headers:
- Authorization: Bearer {sanctum_token}
- Accept: application/json

Response Success:
- success: true
- message: "Logged out successfully"

=== TRADING APIs ===

8. API LẤY TỶ GIÁ HIỆN TẠI
GET /api/exchange/rate
Headers:
- Authorization: Bearer {sanctum_token}
- Accept: application/json

Response Success:
- success: true
- data:
  - usdt_to_vnd: number (tỷ giá 1 USDT = ? VND)
  - vnd_to_usdt: number (tỷ giá 1 VND = ? USDT)
  - last_updated: datetime
  - source: "binance" hoặc "manual"

9. API TẠO GIAO DỊCH MUA USDT
POST /api/transactions/buy-usdt
Headers:
- Authorization: Bearer {sanctum_token}
- Accept: application/json

Request Body:
- vnd_amount: number (required, số VND muốn chuyển)
- exchange_rate: number (required, tỷ giá tại thời điểm tạo giao dịch)
- payment_method: string (required, "bank_transfer")

Verification Requirements:
- User phải đã hoàn thành eKYC với status "completed" hoặc "approved"
- Verification level tối thiểu "basic"

Response Success:
- success: true
- message: "Transaction created successfully"
- data:
  - transaction_id: string
  - type: "buy"
  - vnd_amount: number
  - usdt_amount: number (số USDT sẽ nhận được)
  - exchange_rate: number
  - fee: number (phí giao dịch VND)
  - total_vnd: number (tổng VND cần chuyển)
  - status: "pending_payment"
  - payment_info:
    - bank_name: string
    - account_number: string
    - account_name: string
    - transfer_content: string
    - amount: number
  - expires_at: datetime (thời gian hết hạn thanh toán)
  - qr_code_data: string (dữ liệu QR code)

Response Error:
- success: false
- message: "Invalid amount or rate"
- errors: object với các field bị lỗi

Response Error (eKYC Required):
- success: false
- message: "eKYC verification required"
- error_code: "EKYC_REQUIRED"
- data:
  - verification_required: true
  - current_status: string (ekyc status hiện tại)
  - required_action: "Complete eKYC verification"
  - redirect_to: "/ekyc/intro"

10. API TẠO GIAO DỊCH BÁN USDT
POST /api/transactions/sell-usdt
Headers:
- Authorization: Bearer {sanctum_token}
- Accept: application/json

Request Body:
- usdt_amount: number (required, số USDT muốn bán)
- exchange_rate: number (required, tỷ giá tại thời điểm tạo giao dịch)
- bank_account_id: string (required, ID tài khoản ngân hàng nhận tiền)

Verification Requirements:
- User phải đã hoàn thành eKYC với status "completed" hoặc "approved"
- Verification level tối thiểu "basic"
- User phải có ít nhất 1 tài khoản ngân hàng đã verified

Response Success:
- success: true
- message: "Transaction created successfully"
- data:
  - transaction_id: string
  - type: "sell"
  - usdt_amount: number
  - vnd_amount: number (số VND sẽ nhận được)
  - exchange_rate: number
  - fee_rate: number (tỷ lệ phí %)
  - fee_amount: number (số phí VND)
  - receive_amount: number (số VND thực nhận)
  - status: "pending_crypto_transfer"
  - wallet_info:
    - address: string (địa chỉ ví TRC20)
    - network: "TRC20"
    - amount: number (số USDT cần gửi)
  - qr_code_data: string (dữ liệu QR code cho ví)
  - expires_at: datetime

Response Error:
- success: false
- message: "Invalid amount or insufficient balance"
- errors: object với các field bị lỗi

Response Error (eKYC Required):
- success: false
- message: "eKYC verification required"
- error_code: "EKYC_REQUIRED"
- data:
  - verification_required: true
  - current_status: string (ekyc status hiện tại)
  - required_action: "Complete eKYC verification"
  - redirect_to: "/ekyc/intro"

Response Error (Bank Account Required):
- success: false
- message: "Bank account required"
- error_code: "BANK_ACCOUNT_REQUIRED"
- data:
  - bank_account_required: true
  - required_action: "Add bank account"
  - redirect_to: "/bank-accounts"

=== PAYMENT APIs ===

11. API LẤY DANH SÁCH TÀI KHOẢN NGÂN HÀNG
GET /api/bank-accounts
Headers:
- Authorization: Bearer {sanctum_token}
- Accept: application/json

Response Success:
- success: true
- data:
  - accounts: array
    - id: uuid
    - bank_name: string
    - account_number: string
    - account_name: string
    - is_default: boolean
    - status: "active" | "inactive"
    - created_at: datetime

12. API THÊM TÀI KHOẢN NGÂN HÀNG
POST /api/bank-accounts
Headers:
- Authorization: Bearer {sanctum_token}
- Accept: application/json

Request Body:
- bank_name: string (required)
- account_number: string (required)
- account_name: string (required)
- is_default: boolean (optional, default false)

Response Success:
- success: true
- message: "Bank account added successfully"
- data:
  - id: uuid
  - bank_name: string
  - account_number: string (masked)
  - account_name: string
  - is_default: boolean
  - status: "active"
  - created_at: datetime

13. API LẤY DANH SÁCH ĐỊA CHỈ VÍ TRC20
GET /api/trc20-addresses
Headers:
- Authorization: Bearer {sanctum_token}
- Accept: application/json

Response Success:
- success: true
- data:
  - addresses: array
    - id: uuid
    - address: string (masked)
    - label: string
    - is_default: boolean
    - status: "active" | "inactive"
    - created_at: datetime

14. API THÊM ĐỊA CHỈ VÍ TRC20
POST /api/trc20-addresses
Headers:
- Authorization: Bearer {sanctum_token}
- Accept: application/json

Request Body:
- address: string (required, địa chỉ ví TRC20)
- label: string (required, tên gợi nhớ)
- is_default: boolean (optional, default false)

Response Success:
- success: true
- message: "TRC20 address added successfully"
- data:
  - id: uuid
  - address: string (masked)
  - label: string
  - is_default: boolean
  - status: "active"
  - created_at: datetime

=== TRANSACTION HISTORY APIs ===

15. API LẤY LỊCH SỬ GIAO DỊCH
GET /api/transactions
Headers:
- Authorization: Bearer {sanctum_token}
- Accept: application/json

Query Parameters:
- page: number (optional, default 1)
- limit: number (optional, default 20, max 100)
- type: string (optional, "buy" | "sell" | "all")
- status: string (optional, "pending" | "completed" | "failed" | "all")
- start_date: string (optional, ISO date)
- end_date: string (optional, ISO date)
- month: number (optional, 1-12)
- year: number (optional)

Response Success:
- success: true
- data:
  - transactions: array
    - id: string
    - type: "buy" | "sell"
    - amount: number
    - currency: "VND" | "USDT"
    - exchange_amount: number
    - exchange_currency: "USDT" | "VND"
    - exchange_rate: number
    - fee: number
    - fee_currency: string
    - status: "pending" | "completed" | "failed" | "cancelled"
    - payment_method: string
    - created_at: datetime
    - updated_at: datetime
    - completed_at: datetime (nullable)
  - pagination:
    - current_page: number
    - last_page: number
    - per_page: number
    - total: number
    - from: number
    - to: number

16. API LẤY CHI TIẾT GIAO DỊCH
GET /api/transactions/{transaction_id}
Headers:
- Authorization: Bearer {sanctum_token}
- Accept: application/json

Response Success:
- success: true
- data:
  - id: string
  - type: "buy" | "sell"
  - amount: number
  - currency: "VND" | "USDT"
  - exchange_amount: number
  - exchange_currency: "USDT" | "VND"
  - exchange_rate: number
  - fee: number
  - fee_currency: string
  - total_amount: number
  - receive_amount: number
  - status: string
  - payment_method: string
  - payment_info: object (thông tin thanh toán)
  - wallet_info: object (thông tin ví, nếu có)
  - admin_notes: string (nullable)
  - created_at: datetime
  - updated_at: datetime
  - completed_at: datetime (nullable)

17. API XÁC NHẬN THANH TOÁN (CHO GIAO DỊCH MUA)
POST /api/transactions/{transaction_id}/confirm-payment
Headers:
- Authorization: Bearer {sanctum_token}
- Accept: application/json

Request Body:
- payment_proof: string (optional, base64 image hoặc URL)
- notes: string (optional, ghi chú thêm)

Response Success:
- success: true
- message: "Payment confirmation submitted"
- data:
  - transaction_id: string
  - status: "pending_verification"
  - submitted_at: datetime

18. API XÁC NHẬN CHUYỂN CRYPTO (CHO GIAO DỊCH BÁN)
POST /api/transactions/{transaction_id}/confirm-crypto
Headers:
- Authorization: Bearer {sanctum_token}
- Accept: application/json

Request Body:
- tx_hash: string (required, hash giao dịch blockchain)
- notes: string (optional, ghi chú thêm)

Response Success:
- success: true
- message: "Crypto transfer confirmation submitted"
- data:
  - transaction_id: string
  - status: "pending_verification"
  - tx_hash: string
  - submitted_at: datetime



Password:
- Laravel Hash::make() tự động sử dụng bcrypt
- Minimum 6 characters

OTP:
- 6 chữ số
- Expire sau 5 phút
- Chỉ dùng 1 lần

Sanctum Token:
- 64 characters random string
- Có thể set expiration time
- Có thể revoke tất cả tokens của user

Rate Limiting:
- Login: 5 lần/phút
- OTP: 3 lần/phút
- Register: 3 lần/phút
- Create Transaction: 10 lần/phút
- Get Exchange Rate: 60 lần/phút

=== FLOW HOẠT ĐỘNG VỚI SANCTUM ===

1. Register -> Tạo user với status "pending_verification"
2. Login -> Gửi OTP qua email/phone
3. Verify OTP -> Tạo Sanctum token và trả về cho client
4. Client lưu token và gửi trong header Authorization: Bearer {token}
5. Create Transaction -> Tạo giao dịch với thông tin thanh toán
6. Confirm Payment/Crypto -> User xác nhận đã thanh toán
7. Admin Update Status -> Admin cập nhật trạng thái giao dịch
8. Logout -> Revoke token hiện tại

=== API ENDPOINTS TÓM TẮT ===

Authentication:
1. POST /api/auth/register - Đăng ký
2. POST /api/auth/login - Đăng nhập (gửi OTP)
3. POST /api/auth/send-otp - Gửi OTP
4. POST /api/auth/verify-otp - Xác thực OTP
5. POST /api/auth/resend-otp - Gửi lại OTP
6. GET /api/user - Lấy thông tin user
7. POST /api/auth/logout - Đăng xuất

Trading:
8. GET /api/exchange/rate - Lấy tỷ giá hiện tại
9. POST /api/transactions/buy-usdt - Tạo giao dịch mua USDT
10. POST /api/transactions/sell-usdt - Tạo giao dịch bán USDT

Payment:
11. GET /api/bank-accounts - Lấy danh sách tài khoản ngân hàng
12. POST /api/bank-accounts - Thêm tài khoản ngân hàng
13. GET /api/trc20-addresses - Lấy danh sách địa chỉ ví TRC20
14. POST /api/trc20-addresses - Thêm địa chỉ ví TRC20

Transaction History:
15. GET /api/transactions - Lấy lịch sử giao dịch
16. GET /api/transactions/{id} - Lấy chi tiết giao dịch
17. POST /api/transactions/{id}/confirm-payment - Xác nhận thanh toán
18. POST /api/transactions/{id}/confirm-crypto - Xác nhận chuyển crypto

User Profile:
19. PUT /api/user/profile - Cập nhật thông tin user
20. POST /api/user/avatar - Upload avatar

=== USER PROFILE APIs ===

19. API CẬP NHẬT THÔNG TIN USER
PUT /api/user/profile
Headers:
- Authorization: Bearer {sanctum_token}
- Accept: application/json

Request Body:
- full_name: string (optional)
- date_of_birth: string (optional, ISO date)
- address: string (optional)

Response Success:
- success: true
- message: "Profile updated successfully"
- data:
  - id: uuid
  - full_name: string
  - email: string
  - phone: string
  - date_of_birth: date
  - address: string
  - ekyc_status: string
  - verification_level: string
  - updated_at: datetime

20. API UPLOAD AVATAR
POST /api/user/avatar
Headers:
- Authorization: Bearer {sanctum_token}
- Accept: application/json
- Content-Type: multipart/form-data

Request Body:
- avatar: file (required, image file)

Response Success:
- success: true
- message: "Avatar uploaded successfully"
- data:
  - avatar_url: string
  - updated_at: datetime
